<!DOCTYPE html>
<html lang="en">
  <head>
    <title>The Mix n Match Demo</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- Website ui-->
    <link rel="stylesheet" type="text/css" href="./css/main.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>   
    
    <!-- Real-time Chat thing -->
    <script src="https://messaging-public.realtime.co/js/2.1.0/ortc.js"></script>
    <script src="./lib/client.js"></script>
    <!-- functions -->
    <script src="./lib/data.js"></script>
    <script src="./lib/match.js"></script>
    <script src="./lib/api.js"></script>
    
  </head>  
  <body>
    <div class="card">
    <div class = "card-body">
    <h1 class="card-title">The Mix n Match Demo</h1>
    <p class="card-text">
       This app illustrates how a user can be matched with another user based on the keywords they use, be it from communciating with chatbots, clicking on links, end of page surveys, or posting on the forum.
    </p>
    
    <form>
      <div class="form-group col-md-6">
        <label for="input-name">Username</label>
        <input type="name" class="form-control" id="input-name" placeholder="Steve Jobs">
      </div>
      <div class="col-md-2">
        <button type="button" class="btn btn-primary login-button">Login</button>
      </div>
    </form>
      
  </div>
    </div>
    
    <div class="card">
      <div class="card-body">
        <span class="
    <form>  
<input style="display:none" type="text" id="msgInput" class="materialize-textarea" placeholder="Enter your message">
<button style="display:none" id = "sendButton" class="btn waves-effect waves-light" type="submit" name="action" onclick="sendMessage()">
  Send Message
</button>
      </form>
 <div style="display:none" id="log"></div>
      </div>
    </div>
    
    <script>
    $('.login-button').on('click',function(evt){
      let name = document.querySelector('#input-name').value;
      if(name){
        myName = name;
        // cheat: find myself in the database, then create a person object for myself, then call findclosestmatch()
        var me;
        for(var i = 0;i<data.length;i++){
          if(data[i].Name == myName){
            me = new Person(data[i].ID,data[i].Name,data[i].Gender,data[i].Age,data[i].Ethnicity, data[i].Keywords, data[i].Location);
          }
        }
        if(me == null){
          alert("no user found");
        }
        else{
          var bestmatch = me.findclosestmatch(data);
          chatChannel = me.getId() + bestmatch.getId();
          chatChannel = chatChannel + "";
          connectToRealtime();
          alert("YOUR BEST MATCH IS "+bestmatch.getName());
          document.getElementById("msgInput").style.display = "block";
          document.getElementById("sendButton").style.display = "block";
          document.getElementById("log").style.display = "block";
        }
      }      
    });
    $('#upload-file').on('change',function(evt){
      let file = evt.target.files[0];
      if(file.type.match('\.json')){
        let reader = new FileReader();
        let filename = file.name;
        reader.onload = (function(theFile){
          return function(e){
            generate_prwm_from_json_object(JSON.parse(e.target.result),filename);  
          };
        })(file);
        reader.readAsText(file);
      }
    });
      
    
    </script>
  </body>
</html>
